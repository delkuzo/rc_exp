<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Эксперимент: Pagination Compact - RC Experiment</title>
  <link rel="stylesheet" href="../fonts/fonts.css">
  <link rel="stylesheet" href="../styles.css">
  <script src="../icons/icon-system-v3.js"></script>
  <style>
    .experiment-page { max-width: 1200px; margin: 0; margin-left: 80px; padding: 40px 20px; }
    .experiment-header { display: flex; align-items: center; gap: 16px; margin-bottom: 40px; }
    .back-link { display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; background: var(--color-bg-secondary); color: var(--color-text-secondary); border: 1px solid var(--color-border-secondary); text-decoration: none; transition: all 0.2s ease; }
    .back-link:hover { background: var(--color-hover); color: var(--color-text-primary); border-color: var(--color-border-primary); }
    .back-link svg { width: 16px; height: 16px; }
    .experiment-title { font-family: var(--typography-display-1-font-family); font-weight: var(--typography-display-1-font-weight); font-size: var(--typography-display-1-font-size); line-height: var(--typography-display-1-line-height); color: var(--color-text-primary); margin: 0; }

    /* Pagination: набор outline-кнопок */
    .pagination-row { display: flex; align-items: center; gap: var(--size-s-spec); }
    .btn.btn--style-outline.is-current { background-color: var(--color-control); }
    .pagination-row .btn:focus-visible { outline: 2px solid var(--color-link) !important; outline-offset: 2px !important; }

    /* Вспомогательный класс для aria-live */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
  </style>
</head>
<body>
  <div class="experiment-page">
    <div class="experiment-header">
      <a href="../index.html#experiments" class="btn btn--size-32 btn--style-fill btn--icon-only" aria-label="Назад">
        <span class="btn__icon" id="backIcon-pagination"></span>
      </a>
      <h1 class="experiment-title">Pagination</h1>
    </div>

    <div class="pagination-row" id="pagination32Simple" role="group" aria-label="Пагинация 32 — Простая (до 10)"></div>
    <div class="component-name">Простая (до 10 страниц) • 32</div>

    <div class="pagination-row" id="pagination40Simple" role="group" aria-label="Пагинация 40 — Простая (до 10)" style="margin-top: 12px;"></div>
    <div class="component-name">Простая (до 10 страниц) • 40</div>

    <div class="pagination-row" id="pagination32Segment" role="group" aria-label="Пагинация 32 — Сегментная (>10)" style="margin-top: 24px;"></div>
    <div class="component-name">Сегментная с «в начало/в конец» (>10) • 32</div>

    <div class="pagination-row" id="pagination40Segment" role="group" aria-label="Пагинация 40 — Сегментная (>10)" style="margin-top: 12px;"></div>
    <div class="component-name">Сегментная с «в начало/в конец» (>10) • 40</div>

    <div id="paginationStatus" class="sr-only" aria-live="polite"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.setAttribute('data-theme', savedTheme);
      try { const svg = await window.iconSystemV3.renderIconOriginal('chevron-left', 16, 'icon'); const el = document.getElementById('backIcon-pagination'); if (el) el.innerHTML = svg; } catch {}
    });

    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.setAttribute('data-theme', savedTheme);

      const statusEl = document.getElementById('paginationStatus');

      const getPageItems = (current, total, mode) => {
        if (mode === 'simple' || total <= 10) {
          return Array.from({ length: Math.min(total, 10) }, (_, i) => i + 1);
        }
        // Сегментная логика: всегда 4 видимые страницы (окно), без многоточий здесь
        const windowSize = 4;
        const maxStart = Math.max(1, total - windowSize + 1);
        const start = Math.min(Math.max(current - 1, 1), maxStart);
        return Array.from({ length: windowSize }, (_, i) => start + i);
      };

      const renderPagination = async (container, state, size, mode) => {
        container.innerHTML = '';

        const makeBtn = (label, opts = {}) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          const sizeClass = size === 40 ? 'btn--size-40' : 'btn--size-32';
          btn.className = `btn ${sizeClass} btn--style-outline` + (opts.iconOnly ? ' btn--icon-only' : '');
          if (opts.iconSvg) btn.innerHTML = `<span class="btn__icon">${opts.iconSvg}</span>`; else btn.textContent = label;
          if (opts.title) btn.setAttribute('title', opts.title);
          if (opts.disabled) btn.disabled = true;
          if (opts.page !== undefined) btn.dataset.page = String(opts.page);
          if (opts.current) {
            btn.classList.add('is-current');
            btn.setAttribute('aria-current', 'page');
            btn.setAttribute('aria-label', `Страница ${state.current} из ${state.total}`);
          } else if (opts.page) {
            btn.setAttribute('aria-label', `Страница ${opts.page} из ${state.total}`);
          }
          return btn;
        };

        let prevIcon = '';
        let nextIcon = '';
        let firstIcon = '';
        let lastIcon = '';
        try {
          prevIcon = window.iconSystemV3 && window.iconSystemV3.renderIconOriginal ? await window.iconSystemV3.renderIconOriginal('chevron-left', 16, 'icon') : '';
          nextIcon = window.iconSystemV3 && window.iconSystemV3.renderIconOriginal ? await window.iconSystemV3.renderIconOriginal('chevron-right', 16, 'icon') : '';
          firstIcon = window.iconSystemV3 && window.iconSystemV3.renderIconOriginal ? await window.iconSystemV3.renderIconOriginal('chevrons-left', 16, 'icon') : '';
          lastIcon = window.iconSystemV3 && window.iconSystemV3.renderIconOriginal ? await window.iconSystemV3.renderIconOriginal('chevrons-right', 16, 'icon') : '';
        } catch {}

        // Кнопки для режима >10: в начало/назад
        if (mode === 'segment') {
          const first = makeBtn(firstIcon ? '' : '«', { title: 'В начало', disabled: state.current === 1, iconOnly: true, iconSvg: firstIcon });
          first.setAttribute('aria-label', 'В начало');
          first.dataset.action = 'first';
          container.appendChild(first);
        }

        const prev = makeBtn('', { title: 'Предыдущая', disabled: state.current === 1, iconOnly: true, iconSvg: prevIcon });
        prev.setAttribute('aria-label', 'Предыдущая страница');
        prev.dataset.action = 'prev';
        container.appendChild(prev);

        const items = getPageItems(state.current, state.total, mode === 'segment' ? 'segment' : 'simple');
        items.forEach(item => {
          const pageNum = Number(item);
          const isCurrent = pageNum === state.current;
          const btn = makeBtn(String(pageNum), { page: pageNum, current: isCurrent, iconOnly: true });
          container.appendChild(btn);
        });

        const next = makeBtn('', { title: 'Следующая', disabled: state.current === state.total, iconOnly: true, iconSvg: nextIcon });
        next.setAttribute('aria-label', 'Следующая страница');
        next.dataset.action = 'next';
        container.appendChild(next);

        if (mode === 'segment') {
          const last = makeBtn(lastIcon ? '' : '»', { title: 'В конец', disabled: state.current === state.total, iconOnly: true, iconSvg: lastIcon });
          last.setAttribute('aria-label', 'В конец');
          last.dataset.action = 'last';
          container.appendChild(last);
        }

        if (statusEl) statusEl.textContent = `Текущая страница ${state.current} из ${state.total}`;
      };

      const initPagination = (containerId, total, size, mode) => {
        const container = document.getElementById(containerId);
        const state = { current: 1, total };
        renderPagination(container, state, size, mode);

        container.addEventListener('click', (e) => {
          const target = e.target.closest('button.btn');
          if (!target || target.disabled) return;
          const action = target.dataset.action;
          if (action === 'first') state.current = 1;
          else if (action === 'prev') state.current = Math.max(1, state.current - 1);
          else if (action === 'next') state.current = Math.min(state.total, state.current + 1);
          else if (action === 'last') state.current = state.total;
          else if (target.dataset.page) state.current = Number(target.dataset.page);
          renderPagination(container, state, size, mode);
        });

        container.addEventListener('keydown', (e) => {
          const key = e.key;
          if (key === 'ArrowLeft') { state.current = Math.max(1, state.current - 1); renderPagination(container, state, size, mode); }
          if (key === 'ArrowRight') { state.current = Math.min(state.total, state.current + 1); renderPagination(container, state, size, mode); }
          if (key === 'Home') { state.current = 1; renderPagination(container, state, size, mode); }
          if (key === 'End') { state.current = state.total; renderPagination(container, state, size, mode); }
          if (key === 'PageUp') { state.current = Math.max(1, state.current - 5); renderPagination(container, state, size, mode); }
          if (key === 'PageDown') { state.current = Math.min(state.total, state.current + 5); renderPagination(container, state, size, mode); }
        });

        // Делегируем фокус на контейнер для управления стрелками с клавиатуры
        container.tabIndex = 0;
      };

      // Инициализация: простая (≤10)
      initPagination('pagination32Simple', 10, 32, 'simple');
      initPagination('pagination40Simple', 10, 40, 'simple');
      // Инициализация: сегментная (>10)
      initPagination('pagination32Segment', 25, 32, 'segment');
      initPagination('pagination40Segment', 25, 40, 'segment');
    });
  </script>
</body>
</html>


