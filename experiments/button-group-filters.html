<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Эксперимент: Группа кнопок / фильтры - RC Experiment</title>
    <link rel="stylesheet" href="../fonts/fonts.css">
    <link rel="stylesheet" href="../styles.css">
    <script src="../icons/icon-system-v3.js"></script>
    <style>
        .experiment-page {
            max-width: 1200px;
            margin: 0;
            margin-left: 80px;
            padding: 40px 20px;
        }
        .experiment-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 40px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            border: 1px solid var(--color-border-secondary);
        }
        .back-link:hover {
            background-color: var(--color-hover);
            color: var(--color-text-primary);
            border-color: var(--color-border-primary);
        }
        .back-link svg { width: 16px; height: 16px; }
        .experiment-title {
            font-family: var(--typography-display-2-font-family);
            font-weight: var(--typography-display-2-font-weight);
            font-size: var(--typography-display-2-font-size);
            line-height: var(--typography-display-2-line-height);
            color: var(--color-text-primary);
            margin: 0;
        }

        /* Локальные стили эксперимента */
        .filters-section { max-width: 100%; }
        .filters-title {
            font-family: var(--typography-header-1-font-family);
            font-weight: var(--typography-header-1-font-weight);
            font-size: var(--typography-header-1-font-size);
            line-height: var(--typography-header-1-line-height);
            color: var(--color-text-primary);
            margin: 0 0 var(--size-m) 0; /* 16px между заголовком и рядом контроллов */
        }
        .filters-row {
            display: flex;
            align-items: center;
            gap: var(--size-s-spec); /* 12px по UI‑киту */
            flex-wrap: nowrap;
        }
        .filters-row .select-container { min-width: 190px; }

        /* Локальная настройка вида опций месяца: месяц слева, год справа вторичным цветом */
        .select-dropdown .select-option {
            justify-content: space-between;
        }
        .select-option-month {
            color: var(--color-text-primary);
            font-family: 'YS Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.4;
        }
        .select-option-year {
            color: var(--color-text-secondary);
            margin-left: auto;
            font-family: 'YS Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.4;
        }
        .select-divider {
            height: 1px;
            background-color: var(--color-border-primary);
            margin: var(--size-xxs) var(--size-s-spec);
            border-radius: 1px;
        }

        /* Встроенный календарь в dropdown (берем стили из эксперимента "Календарь") */
        .calendar-container { display: flex; flex-direction: column; gap: var(--size-m); width: max-content; padding: var(--size-m); }
        .calendar-header { display: flex; align-items: center; gap: var(--size-s); }
        .calendar-titles { display: inline-flex; align-items: center; justify-content: flex-start; gap: 0; width: 100%; }
        .calendar-side { display: inline-flex; align-items: center; gap: var(--size-s); }
        .calendar-gap { flex: 0 0 var(--size-m); width: var(--size-m); }
        .calendar-title-group { position: relative; }
        .calendar-title-button { display: inline-flex; align-items: center; gap: var(--size-xs); padding: 0; border-radius: 6px; background: transparent; border: none; color: var(--color-red); cursor: default; font-family: var(--typography-header-1-font-family); font-weight: var(--typography-header-1-font-weight); font-size: var(--typography-header-1-font-size); line-height: var(--typography-header-1-line-height); }
        .calendar-nav-btn { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border: none; background: transparent; color: var(--color-red); cursor: pointer; transform: translateY(2px); }
        .calendar-nav-btn:hover { background: transparent; color: var(--color-text-primary); }
        .calendar-title-icon { width: 16px; height: 16px; display: inline-flex; }
        .calendar-title-text--month { display: inline; text-align: left; }
        .calendar-title-text--year { display: inline; text-align: right; }
        /* При ховере на стрелку затемняем соответствующий заголовок (месяц/год) */
        .calendar-side:has(.calendar-nav-btn:hover) .calendar-title-text--month { color: var(--color-text-primary); }
        .calendar-side:has(.calendar-nav-btn:hover) .calendar-title-text--year { color: var(--color-text-primary); }
        .calendar-dropdown { max-height: 180px; overflow-y: auto; margin-top: 4px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--size-s); }
        .calendar-weekday { text-align: center; color: var(--color-text-secondary); font-family: var(--typography-caption-2-font-family); font-weight: var(--typography-caption-2-font-weight); font-size: var(--typography-caption-2-font-size); line-height: var(--typography-caption-2-line-height); }
        .calendar-day-btn.btn { width: 32px; height: 32px; padding: 0; border-radius: 50%; justify-content: center; align-items: center; }
        .calendar-day-btn.btn.btn--style-blank { background: transparent; }
        .calendar-day-btn.btn.btn--style-blank:hover { background: var(--color-control); }
        .calendar-day-btn.is-other-month { opacity: 0.5; }

        /* Расширяем дропдаун под календарь (не ограничивать шириной кнопки) */
        #selectDropdown-month2 { right: auto; width: auto; min-width: calc(7 * 32px + 6 * var(--size-s) + 2 * var(--size-m)); }

        /* Адаптивность: на мобильных переносим в столбик */
        @media (max-width: 768px) {
            .experiment-page { margin-left: 20px; padding: 20px 16px; }
            .filters-row {
                flex-direction: column;
                align-items: stretch;
                gap: var(--size-m);
            }
        }
    </style>
</head>
<body>
    <div class="experiment-page">
        <div class="experiment-header">
            <a href="../index.html#experiments" class="btn btn--size-32 btn--style-fill btn--icon-only" aria-label="Назад">
                <span class="btn__icon" id="backIcon-filters"></span>
            </a>
            <h1 class="experiment-title">Группа кнопок / фильтры</h1>
        </div>

        <div class="experiment-result">
            <section class="filters-section" aria-labelledby="filtersTitle">
                <h4 id="filtersTitle" class="filters-title">Сформируйте отчет</h4>

                <!-- Вариант 1: исходный набор с выпадающим списком месяцев -->
                <div class="filters-row" role="group" aria-label="Панель фильтров — вариант 1">
                    <!-- Select: Регион -->
                    <div class="select-container" data-select="region">
                        <button type="button" class="select-button select-button--size-40" id="selectButton-region" aria-haspopup="listbox" aria-expanded="false" aria-controls="selectDropdown-region">
                            <span class="select-text">Регион</span>
                            <span class="select-icon" id="selectIcon-region">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </span>
                        </button>
                        <div class="select-dropdown" id="selectDropdown-region" role="listbox" aria-hidden="true">
                            <div class="select-option" role="option" tabindex="0" data-value="moscow"><span class="select-option-text">Москва</span></div>
                            <div class="select-option" role="option" tabindex="0" data-value="spb"><span class="select-option-text">Санкт-Петербург</span></div>
                            <div class="select-option" role="option" tabindex="0" data-value="novosibirsk"><span class="select-option-text">Новосибирск</span></div>
                            <div class="select-option" role="option" tabindex="0" data-value="ekb"><span class="select-option-text">Екатеринбург</span></div>
                            <div class="select-option" role="option" tabindex="0" data-value="kazan"><span class="select-option-text">Казань</span></div>
                        </div>
                    </div>

                    <!-- Select: Платформа -->
                    <div class="select-container" data-select="platform">
                        <button type="button" class="select-button select-button--size-40" id="selectButton-platform" aria-haspopup="listbox" aria-expanded="false" aria-controls="selectDropdown-platform">
                            <span class="select-text">Платформа</span>
                            <span class="select-icon" id="selectIcon-platform">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </span>
                        </button>
                        <div class="select-dropdown" id="selectDropdown-platform" role="listbox" aria-hidden="true">
                            <div class="select-option" role="option" tabindex="0" data-value="desktop"><span class="select-option-text">Десктоп</span></div>
                            <div class="select-option" role="option" tabindex="0" data-value="app"><span class="select-option-text">Приложение</span></div>
                            <div class="select-option" role="option" tabindex="0" data-value="mweb"><span class="select-option-text">Мобильный веб</span></div>
                        </div>
                    </div>

                    <!-- Select: Тип данных -->
                    <div class="select-container" data-select="datatype">
                        <button type="button" class="select-button select-button--size-40" id="selectButton-datatype" aria-haspopup="listbox" aria-expanded="false" aria-controls="selectDropdown-datatype">
                            <span class="select-text">Тип данных</span>
                            <span class="select-icon" id="selectIcon-datatype">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </span>
                        </button>
                        <div class="select-dropdown" id="selectDropdown-datatype" role="listbox" aria-hidden="true">
                            <div class="select-option" role="option" tabindex="0" data-value="table"><span class="select-option-text">Таблица</span></div>
                            <div class="select-option" role="option" tabindex="0" data-value="xml"><span class="select-option-text">XML</span></div>
                            <div class="select-option" role="option" tabindex="0" data-value="query"><span class="select-option-text">Запрос</span></div>
                        </div>
                    </div>

                    <!-- Select: Дата (месяц списком) -->
                    <div class="select-container" data-select="month">
                        <button type="button" class="select-button select-button--size-40" id="selectButton-month" aria-haspopup="listbox" aria-expanded="false" aria-controls="selectDropdown-month">
                            <span class="select-text">Дата</span>
                            <span class="select-icon" id="selectIcon-month">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </span>
                        </button>
                        <div class="select-dropdown" id="selectDropdown-month" role="listbox" aria-hidden="true">
                            <!-- 12 месяцев: Август 2024 — Декабрь 2024 -->
                            <div class="select-option" role="option" tabindex="0" data-value="2024-08">
                                <span class="select-option-month">Август</span>
                                <span class="select-option-year">2024</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2024-09">
                                <span class="select-option-month">Сентябрь</span>
                                <span class="select-option-year">2024</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2024-10">
                                <span class="select-option-month">Октябрь</span>
                                <span class="select-option-year">2024</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2024-11">
                                <span class="select-option-month">Ноябрь</span>
                                <span class="select-option-year">2024</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2024-12">
                                <span class="select-option-month">Декабрь</span>
                                <span class="select-option-year">2024</span>
                            </div>
                            <!-- Разделитель смены года -->
                            <div class="select-divider" aria-hidden="true"></div>
                            <!-- 2025 -->
                            <div class="select-option" role="option" tabindex="0" data-value="2025-01">
                                <span class="select-option-month">Январь</span>
                                <span class="select-option-year">2025</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2025-02">
                                <span class="select-option-month">Февраль</span>
                                <span class="select-option-year">2025</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2025-03">
                                <span class="select-option-month">Март</span>
                                <span class="select-option-year">2025</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2025-04">
                                <span class="select-option-month">Апрель</span>
                                <span class="select-option-year">2025</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2025-05">
                                <span class="select-option-month">Май</span>
                                <span class="select-option-year">2025</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2025-06">
                                <span class="select-option-month">Июнь</span>
                                <span class="select-option-year">2025</span>
                            </div>
                            <div class="select-option" role="option" tabindex="0" data-value="2025-07">
                                <span class="select-option-month">Июль</span>
                                <span class="select-option-year">2025</span>
                            </div>
                        </div>
                    </div>

                    <!-- Primary Button -->
                    <button class="btn btn--style-action btn--size-40" type="button" id="build-report-btn">Сформировать</button>
                </div>

                <!-- Вариант 2: тот же набор, но селект Даты со встроенным календарём -->
                <div class="filters-row" role="group" aria-label="Панель фильтров — вариант 2" style="margin-top: 24px;">
                    <!-- Select: Регион -->
                    <div class="select-container" data-select="region">
                        <button type="button" class="select-button select-button--size-40" aria-haspopup="listbox" aria-expanded="false">
                            <span class="select-text">Регион</span>
                            <span class="select-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </span>
                        </button>
                        <div class="select-dropdown" role="listbox" aria-hidden="true">
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">Москва</span></div>
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">Санкт-Петербург</span></div>
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">Новосибирск</span></div>
                        </div>
                    </div>

                    <!-- Select: Платформа -->
                    <div class="select-container" data-select="platform">
                        <button type="button" class="select-button select-button--size-40" aria-haspopup="listbox" aria-expanded="false">
                            <span class="select-text">Платформа</span>
                            <span class="select-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </span>
                        </button>
                        <div class="select-dropdown" role="listbox" aria-hidden="true">
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">Десктоп</span></div>
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">Приложение</span></div>
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">Мобильный веб</span></div>
                        </div>
                    </div>

                    <!-- Select: Тип данных -->
                    <div class="select-container" data-select="datatype">
                        <button type="button" class="select-button select-button--size-40" aria-haspopup="listbox" aria-expanded="false">
                            <span class="select-text">Тип данных</span>
                            <span class="select-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </span>
                        </button>
                        <div class="select-dropdown" role="listbox" aria-hidden="true">
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">Таблица</span></div>
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">XML</span></div>
                            <div class="select-option" role="option" tabindex="0"><span class="select-option-text">Запрос</span></div>
                        </div>
                    </div>

                    <!-- Select: Дата (встроенный календарь) -->
                    <div class="select-container" id="selectContainer-month2" data-select="month">
                        <button type="button" class="select-button select-button--size-40" id="selectButton-month2" aria-haspopup="listbox" aria-expanded="false" aria-controls="selectDropdown-month2">
                            <span class="select-text" id="monthText2">Дата</span>
                            <span class="select-icon" id="selectIcon-month2">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </span>
                        </button>
                        <div class="select-dropdown" id="selectDropdown-month2" role="listbox" aria-hidden="true">
                            <div class="calendar-container">
                                <div class="calendar-header">
                                    <div class="calendar-titles">
                                        <div class="calendar-side" style="justify-content:flex-start; gap: 8px; flex: 0 0 auto;">
                                            <button class="calendar-nav-btn" id="monthPrevBtn" aria-label="Предыдущий месяц"><span id="iconMonthPrev"></span></button>
                                            <div class="calendar-title-group">
                                                <div class="calendar-title-button"><span class="calendar-title-text--month" id="monthTitleText2">—</span></div>
                                            </div>
                                            <button class="calendar-nav-btn" id="monthNextBtn" aria-label="Следующий месяц"><span id="iconMonthNext"></span></button>
                                        </div>
                                        <div class="calendar-gap" style="flex: 1 1 auto;"></div>
                                        <div class="calendar-side" style="justify-content:flex-end; margin-left:auto; gap: 8px; flex: 0 0 auto; min-width: max-content;">
                                            <button class="calendar-nav-btn" id="yearPrevBtn" aria-label="Предыдущий год"><span id="iconYearPrev"></span></button>
                                            <div class="calendar-title-group">
                                                <div class="calendar-title-button"><span class="calendar-title-text--year" id="yearTitleText2">—</span></div>
                                            </div>
                                            <button class="calendar-nav-btn" id="yearNextBtn" aria-label="Следующий год"><span id="iconYearNext"></span></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="calendar-grid" id="calendarWeekdays2" aria-hidden="true"></div>
                                <div class="calendar-grid" id="calendarDays2" role="grid" aria-label="Выбор даты"></div>
                                <div id="calendarStatus2" class="sr-only" aria-live="polite"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Primary Button -->
                    <button class="btn btn--style-action btn--size-40" type="button">Сформировать</button>
                </div>
            </section>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Применяем сохраненную тему и иконку back
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            try {
                const svg = await window.iconSystemV3.renderIconOriginal('chevron-left', 16, 'icon');
                const el = document.getElementById('backIcon-filters');
                if (el) el.innerHTML = svg;
            } catch {}
            // Инициализация всех локальных select-компонентов в этой странице
            initializeLocalSelects();
            // Рендерим иконки chevron для навигации календаря (вариант 2)
            try {
                const left = await window.iconSystemV3.renderIconOriginal('chevron-left', 16, 'icon');
                const right = await window.iconSystemV3.renderIconOriginal('chevron-right', 16, 'icon');
                const mPrev = document.getElementById('iconMonthPrev'); if (mPrev) mPrev.innerHTML = left;
                const mNext = document.getElementById('iconMonthNext'); if (mNext) mNext.innerHTML = right;
                const yPrev = document.getElementById('iconYearPrev'); if (yPrev) yPrev.innerHTML = left;
                const yNext = document.getElementById('iconYearNext'); if (yNext) yNext.innerHTML = right;
            } catch {}
        });

        function initializeLocalSelects() {
            const containers = document.querySelectorAll('.filters-row .select-container');

            const closeAll = (except = null) => {
                containers.forEach(cn => {
                    if (cn === except) return;
                    const btn = cn.querySelector('.select-button');
                    const dd = cn.querySelector('.select-dropdown');
                    const icon = cn.querySelector('.select-icon');
                    if (dd && dd.classList.contains('select-dropdown-open')) {
                        dd.classList.remove('select-dropdown-open');
                        btn && btn.setAttribute('aria-expanded', 'false');
                        icon && icon.classList.remove('select-icon-up');
                        dd.setAttribute('aria-hidden', 'true');
                    }
                });
            };

            containers.forEach(container => {
                const button = container.querySelector('.select-button');
                const dropdown = container.querySelector('.select-dropdown');
                const icon = container.querySelector('.select-icon');
                const options = dropdown.querySelectorAll('.select-option');

                const toggle = () => {
                    const isOpen = dropdown.classList.contains('select-dropdown-open');
                    if (isOpen) {
                        dropdown.classList.remove('select-dropdown-open');
                        button.setAttribute('aria-expanded', 'false');
                        icon.classList.remove('select-icon-up');
                        dropdown.setAttribute('aria-hidden', 'true');
                    } else {
                        closeAll(container);
                        dropdown.classList.add('select-dropdown-open');
                        button.setAttribute('aria-expanded', 'true');
                        icon.classList.add('select-icon-up');
                        dropdown.setAttribute('aria-hidden', 'false');
                    }
                };

                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    toggle();
                });

                options.forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        // Универсально получаем текст опции: обычный (.select-option-text) или кастомный (месяц+год)
                        const textNode = option.querySelector('.select-option-text');
                        let text;
                        if (textNode) {
                            text = textNode.textContent;
                        } else {
                            const monthEl = option.querySelector('.select-option-month');
                            const yearEl = option.querySelector('.select-option-year');
                            if (monthEl && yearEl) {
                                text = `${monthEl.textContent}, ${yearEl.textContent}`;
                            } else {
                                text = option.textContent.trim();
                            }
                        }
                        button.querySelector('.select-text').textContent = text;
                        options.forEach(o => o.classList.remove('select-option-selected'));
                        option.classList.add('select-option-selected');
                        toggle();
                    });
                    option.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            option.click();
                        }
                    });
                });

                button.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ' || e.key === 'ArrowDown') {
                        e.preventDefault();
                        if (!dropdown.classList.contains('select-dropdown-open')) toggle();
                        const first = dropdown.querySelector('.select-option');
                        first && first.focus();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        if (dropdown.classList.contains('select-dropdown-open')) toggle();
                    }
                });
            });

            // Клик вне — закрыть все, но если клик внутри конкретного контейнера, его не закрываем
            document.addEventListener('click', (e) => {
                const target = e.target;
                containers.forEach(cn => {
                    if (cn.contains(target)) return; // не закрываем тот, в котором клик
                    const btn = cn.querySelector('.select-button');
                    const dd = cn.querySelector('.select-dropdown');
                    const icon = cn.querySelector('.select-icon');
                    if (dd && dd.classList.contains('select-dropdown-open')) {
                        dd.classList.remove('select-dropdown-open');
                        btn && btn.setAttribute('aria-expanded', 'false');
                        icon && icon.classList.remove('select-icon-up');
                        dd.setAttribute('aria-hidden', 'true');
                    }
                });
            });

            // Инициализация встроенного календаря для селекта месяца (вторая версия)
            initEmbeddedCalendar();
        }

        function initEmbeddedCalendar() {
            // Месяцы и базовое состояние
            const monthNames = ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'];
            const weekdays = ['Пн','Вт','Ср','Чт','Пт','Сб','Вс'];
            const state = { viewYear: new Date().getFullYear(), viewMonth: new Date().getMonth(), selected: null, today: new Date() };

            const monthTitleText = document.getElementById('monthTitleText2');
            const yearTitleText = document.getElementById('yearTitleText2');
            const weekdaysContainer = document.getElementById('calendarWeekdays2');
            const daysContainer = document.getElementById('calendarDays2');
            const monthTextOnButton = document.getElementById('monthText2');

            if (!monthTitleText || !yearTitleText || !weekdaysContainer || !daysContainer) return;

            // Кнопки навигации месяца/года
            const monthPrevBtn = document.getElementById('monthPrevBtn');
            const monthNextBtn = document.getElementById('monthNextBtn');
            const yearPrevBtn = document.getElementById('yearPrevBtn');
            const yearNextBtn = document.getElementById('yearNextBtn');

            // Недели
            weekdaysContainer.innerHTML = '';
            weekdays.forEach(w => { const el = document.createElement('div'); el.className = 'calendar-weekday'; el.textContent = w; weekdaysContainer.appendChild(el); });

            function setMonthYearLabel() {
                // Показываем текущий месяц, но для стабилизации ширины сам контейнер имеет padding
                monthTitleText.textContent = monthNames[state.viewMonth];
                yearTitleText.textContent = String(state.viewYear);
            }

            function compareDates(y, m, d, dateObj) { return y === dateObj.getFullYear() && m === dateObj.getMonth() && d === dateObj.getDate(); }

            function renderDays() {
                daysContainer.innerHTML = '';
                const firstOfMonth = new Date(state.viewYear, state.viewMonth, 1);
                let startWeekDay = firstOfMonth.getDay(); if (startWeekDay === 0) startWeekDay = 7;
                const daysInPrevMonth = new Date(state.viewYear, state.viewMonth, 0).getDate();
                const daysInMonth = new Date(state.viewYear, state.viewMonth + 1, 0).getDate();
                const leading = startWeekDay - 1;
                const totalCells = Math.ceil((leading + daysInMonth) / 7) * 7;
                for (let cell = 0; cell < totalCells; cell++) {
                    const dayNum = cell - leading + 1;
                    const isPrev = cell < leading;
                    const isNext = cell >= (leading + daysInMonth);
                    let y = state.viewYear; let m = state.viewMonth; let d;
                    if (isPrev) { m = (m + 11) % 12; y = state.viewMonth === 0 ? y - 1 : y; d = daysInPrevMonth - (leading - cell - 1); }
                    else if (isNext) { m = (m + 1) % 12; y = state.viewMonth === 11 ? y + 1 : y; d = (cell - (leading + daysInMonth)) + 1; }
                    else { d = dayNum; }
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'btn btn--size-32 btn--style-blank btn--icon-only calendar-day-btn';
                    btn.textContent = String(d);
                    btn.dataset.y = String(y); btn.dataset.m = String(m); btn.dataset.d = String(d);
                    if (isPrev || isNext) btn.classList.add('is-other-month');
                    if (compareDates(y, m, d, state.today)) { btn.classList.remove('btn--style-blank'); btn.classList.add('btn--style-action', 'is-today'); }
                    if (state.selected && y === state.selected.y && m === state.selected.m && d === state.selected.d) { btn.classList.remove('btn--style-blank'); btn.classList.add('btn--style-outline'); }
                    btn.addEventListener('click', () => {
                        state.viewYear = y; state.viewMonth = m; state.selected = { y, m, d };
                        setMonthYearLabel(); renderDays();
                        // Проставляем выбранную дату в текст кнопки селекта и закрываем dropdown (вариант 2)
                        if (monthTextOnButton) {
                            const monthLabel = monthNames[m];
                            monthTextOnButton.textContent = `${String(d).padStart(2,'0')} ${monthLabel} ${y}`;
                        }
                    });
                    daysContainer.appendChild(btn);
                }
            }

            // Обработчики стрелок
            monthPrevBtn && monthPrevBtn.addEventListener('click', () => { state.viewMonth = (state.viewMonth + 11) % 12; if (state.viewMonth === 11) state.viewYear -= 1; setMonthYearLabel(); renderDays(); });
            monthNextBtn && monthNextBtn.addEventListener('click', () => { state.viewMonth = (state.viewMonth + 1) % 12; if (state.viewMonth === 0) state.viewYear += 1; setMonthYearLabel(); renderDays(); });
            yearPrevBtn && yearPrevBtn.addEventListener('click', () => { state.viewYear -= 1; setMonthYearLabel(); renderDays(); });
            yearNextBtn && yearNextBtn.addEventListener('click', () => { state.viewYear += 1; setMonthYearLabel(); renderDays(); });

            setMonthYearLabel(); renderDays();
        }
    </script>
</body>
</html>


